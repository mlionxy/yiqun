(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{590:function(t,a,s){"use strict";s.r(a);var n=s(14),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"elasticsearch知识体系详解"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch知识体系详解"}},[t._v("#")]),t._v(" ElasticSearch知识体系详解")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Hi")]),t._v(" "),s("p",[t._v("你好，我是伊群。这里分享一些我整理的技术资料，以及对他们的看法，希望对大家有帮助！")])]),t._v(" "),s("ul",[s("li",[t._v("快速上手 http://www.ruanyifeng.com/blog/2017/08/elasticsearch.html")]),t._v(" "),s("li",[t._v("ES基础部分")]),t._v(" "),s("li",[t._v("ES的工作过程")])]),t._v(" "),s("h2",{attrs:{id:"es基础部分"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#es基础部分"}},[t._v("#")]),t._v(" ES基础部分")]),t._v(" "),s("blockquote",[s("p",[t._v("两个端口(9200/9300)")])]),t._v(" "),s("ul",[s("li",[t._v("节点客户端（Node Client）\n节点客户端作为一个非数据节点加入到本地集群中。换句话说，它本身不保存任何数据，但是它知道数据在集群中的哪个节点中，并且可以把请求转发到正确的节点。")]),t._v(" "),s("li",[t._v("传输客户端（Transport Client）\n轻量级的传输客户端可以将请求发送到远程集群。它本身不加入集群，但是它可以将请求转发到集群中的一个节点上。")])]),t._v(" "),s("p",[t._v("两个 Java 客户端都是通过 9300 端口并使用 Elasticsearch 的原生 传输 协议和集群交互。集群中的节点通过端口 9300 彼此通信。如果这个端口没有打开，节点将无法形成一个集群。")]),t._v(" "),s("blockquote",[s("p",[t._v("Near Realtime (NRT)")])]),t._v(" "),s("p",[t._v("ES号称对外提供的是近实时的搜索服务，意思是数据从写入ES到可以被Searchable仅仅需要1秒钟，所以说基于ES执行的搜索和分析可以达到秒级。")]),t._v(" "),s("blockquote",[s("p",[t._v("Node 与 Cluster\nElastic 本质上是一个分布式数据库，允许多台服务器协同工作，每台服务器可以运行多个 Elastic 实例。\n单个 Elastic 实例称为一个节点（node）。一组节点构成一个集群（cluster）。")])]),t._v(" "),s("blockquote",[s("p",[t._v("Index")])]),t._v(" "),s("p",[t._v("index是一类拥有相似属性的document的集合，index名称必须是小写的字符。比如用户可以创建一个index，产品可以创建一个index，订单也可以创建一个index。")]),t._v(" "),s("blockquote",[s("p",[t._v("Type")])]),t._v(" "),s("p",[t._v("type作为index中的逻辑类别。比如用户这个index下，可以分用户的type，爱好的type")]),t._v(" "),s("blockquote",[s("p",[t._v("Document")])]),t._v(" "),s("p",[t._v("document就是ES中存储的一条数据，就像mysql中的一行记录一样。")]),t._v(" "),s("blockquote",[s("p",[t._v("ES与Mysql对比着看")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("ES")]),t._v(" "),s("th",[t._v("MySQL")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("index")]),t._v(" "),s("td",[t._v("数据库")])]),t._v(" "),s("tr",[s("td",[t._v("type")]),t._v(" "),s("td",[t._v("表")])]),t._v(" "),s("tr",[s("td",[t._v("document")]),t._v(" "),s("td",[t._v("行")])])])]),t._v(" "),s("blockquote",[s("p",[t._v("Shards")])]),t._v(" "),s("p",[t._v("shard可以理解为ES中的最小工作单元，可以理解为一个lucene的实现，拥有完整的创建索引，处理请求的能力。shard分为primary shard和replicas shard，primary shard与其对应的replicas shard不能同时存在于一台server中，当primary shard宕机时，其对应的replicas shard可以继续响应用户的都请求。通过这种分片的机制，可以横向的成倍提升系统的吞吐量，比如一个shard可以处理200/s请求，此时再加一个服务器，就能支持400/s请求，天生分布式，高可用。此外，每个一document肯定存在一个primary shard和对应的replica shard中，绝对不会出现同一个document同时存在于多个primary shard中的情况。\n问题的引入：如果让一个index自己存储1TB的数据，响应的速度就会下降，为了解决这个问题，ES提供了一种将用户的index进行subdivide(分割，再分割)的操作，就是将index分片，每一片都叫一个shards，进而实现了将整体庞大的数据分布在不同的服务器上存储。")]),t._v(" "),s("h3",{attrs:{id:"启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[t._v("#")]),t._v(" 启动")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("nohup ./bin/elaseticsearch >xxx.log 2>&1 &")])]),t._v(" "),s("li",[t._v("请求"),s("code",[t._v("curl localhost:9200")]),t._v("得到说明信息")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("esuser@VM_0_12_centos elasticsearch-5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" localhost:9200\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Q-gAi65"')]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cluster_name"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"elasticsearch"')]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"cluster_uuid"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ZzneLnfdSIOPMp1bjA9shQ"')]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"version"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"number"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5.5.1"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"build_hash"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"19c13d0"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"build_date"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2017-07-18T20:44:24.823Z"')]),t._v(",\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"build_snapshot"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" false,\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lucene_version"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6.6.0"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(",\n  "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tagline"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"You Know, for Search"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("关闭 "),s("code",[t._v("ps -ef | grep elasticsearch")]),t._v(" "),s("code",[t._v("kill -9 PID")])]),t._v(" "),s("li",[t._v("默认情况下，Elastic 只允许本机访问，如果需要远程访问，可以修改 Elastic 安装目录的config/elasticsearch.yml文件，去掉network.host的注释，将它的值改成0.0.0.0，然后重新启动 Elastic，打开网页访问。")]),t._v(" "),s("li",[t._v("创建索引 curl -X PUT 'localhost:9200/accounts' -H 'content-Type:application/json' -d 'JSON数据'")]),t._v(" "),s("li",[t._v("删除索引 curl -X DELETE 'localhost:9200/accounts'")]),t._v(" "),s("li",[t._v("列出每个index所包含的type curl 'localhost:9200/_mapping?pretty=true'")]),t._v(" "),s("li",[t._v('新增数据（指定id为1） curl -X PUT \'localhost:9200/accounts/person/1\' -H \'content-Type:application/json\' -d \'{"user":"张三","title":"工程师","desc":"数据库管理"}\'')]),t._v(" "),s("li",[t._v('新增数据（使用POST不指定id） curl -X POST \'localhost:9200/accounts/person\' -H \'content-Type:application/json\' -d \'{"user":"张三","title":"工程师","desc":"数据库管理"}\'')]),t._v(" "),s("li",[t._v('更新数据 curl -X PUT \'localhost:9200/accounts/person/1\' -H \'content-Type:application/json\' -d \'{"user":"张三","title":"工程师","desc":"数据库管理"}\'')]),t._v(" "),s("li",[t._v("查看记录(返回不带索引信息) culr 'localhost:9200/accounts/person/1'")]),t._v(" "),s("li",[t._v("查看记录(返回带索引信息) culr 'localhost:9200/accounts/person/1?pretty=true'")]),t._v(" "),s("li",[t._v("搜索所有记录 curl 'localhost:9200/accounts/person/_search'")]),t._v(" "),s("li",[t._v('条件搜索（es的match） curl \'localhost:9200/accounts/person/_search\' -d \'{"query": {"match": {"desc": "系统"}}}\'')]),t._v(" "),s("li",[t._v('条件搜索 or curl \'localhost:9200/accounts/person/_search\' -d \'{"query": {"match": {"desc": "系统 计算"}}}\' -H \'content-Type:application/json\'')]),t._v(" "),s("li",[t._v('条件搜索 and(执行多个关键词的and搜索，必须使用布尔查询) curl \'localhost:9200/accounts/person/_search\' -H \'content-Type:application/json\' -d \'{"query":{"bool":{"must":[{"match": {"desc": "数据库"}}, {"match": {"desc": "管理"}}]}}}\'')]),t._v(" "),s("li",[t._v("查看集群的健康状态")]),t._v(" "),s("li",[t._v("curl后跟-i可以显示http头信息")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('[root@VM-0-16-centos ~]# curl -XGET \'http://localhost:9200/_count?pretty\' -d \'{"query": {"match_all": {}}}\' -i\nHTTP/1.1 200 OK\nWarning: 299 Elasticsearch-5.5.1-19c13d0 "Content type detection for rest requests is deprecated. Specify the content type using the [Content-Type] header." "Mon, 15 Mar 2021 07:31:04 GMT"\ncontent-type: application/json; charset=UTF-8\ncontent-length: 95\n{\n  "count" : 0,\n  "_shards" : {\n    "total" : 0,\n    "successful" : 0,\n    "failed" : 0\n  }\n}\n\n')])])]),s("h2",{attrs:{id:"常用url"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用url"}},[t._v("#")]),t._v(" 常用url")]),t._v(" "),s("ul",[s("li",[t._v("查看集群的健康状况 http://localhost:9200/_cat")]),t._v(" "),s("li",[t._v("查看 http://118.24.164.117:9200/_cat/health?v\n说明：v是用来要求在结果中返回表头\n状态值说明\n"),s("ul",[s("li",[t._v("Green - everything is good (cluster is fully functional)，即最佳状态")]),t._v(" "),s("li",[t._v("Yellow - all data is available but some replicas are not yet allocated (cluster is fully functional)，即数据和集群可用，但是集群的备份有的是坏的")]),t._v(" "),s("li",[t._v("Red - some data is not available for whatever reason (cluster is partially functional)，即数据和集群都不可用")])])]),t._v(" "),s("li",[t._v("查看集群的节点 http://localhost:9200/_cat/?v")]),t._v(" "),s("li",[t._v("查看所有索引 http://118.24.164.117:9200/_cat/indices?v")])]),t._v(" "),s("h2",{attrs:{id:"索引"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#索引"}},[t._v("#")]),t._v(" 索引")]),t._v(" "),s("ul",[s("li",[t._v("创建索引")]),t._v(" "),s("li",[t._v('构建索引映射\n映射类别 Mapping type 废除说明\nES最先的设计是用索引类比关系型数据库的数据库，用mapping type 来类比表，一个索引中可以包含多个映射类别。这个类比存在一个严重的问题，就是当多个mapping type中存在同名字段时（特别是同名字段还是不同类型的），在一个索引中不好处理，因为搜索引擎中只有 索引-文档的结构，不同映射类别的数据都是一个一个的文档（只是包含的字段不一样而已）\n从6.0.0开始限定仅包含一个映射类别定义（ "index.mapping.single_type": true ），兼容5.x中的多映射类别。从7.0开始将移除映射类别')])]),t._v(" "),s("h2",{attrs:{id:"es常见问题汇总"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#es常见问题汇总"}},[t._v("#")]),t._v(" ES常见问题汇总")]),t._v(" "),s("h3",{attrs:{id:"内存不足"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#内存不足"}},[t._v("#")]),t._v(" 内存不足")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM_0_12_centos elasticsearch-5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./bin/elasticsearch")]),t._v("\nJava HotSpot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("-Bit Server VM warning: INFO: os::commit_memory"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("0x0000000085330000, "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2060255232")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" failed"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cannot allocate memory'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("errno"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# There is insufficient memory for the Java Runtime Environment to continue.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Native memory allocation (mmap) failed to map 2060255232 bytes for committing reserved memory.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# An error report file with more information is saved as:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# /root/software/elasticsearch-5.5.1/hs_err_pid26326.log")]),t._v("\n\n* 解决方案\n\n编辑安装目录/elasticsearch-5.1.1/config下的jvm.options\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#-Xms2g(默认是2g)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#-Xmx2g(默认是2g)")]),t._v("\n-Xms128m\n-Xmx128m\n")])])]),s("h3",{attrs:{id:"不能以root用户启动es"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#不能以root用户启动es"}},[t._v("#")]),t._v(" 不能以root用户启动es")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@VM_0_12_centos elasticsearch-5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ./bin/elasticsearch")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-27T16:48:47,418"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("WARN "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("o.e.b.ElasticsearchUncaughtExceptionHandler"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" uncaught exception "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" thread "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\norg.elasticsearch.bootstrap.StartupException: java.lang.RuntimeException: can not run elasticsearch as root\n        at org.elasticsearch.bootstrap.Elasticsearch.init"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Elasticsearch.java:127"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("elasticsearch-5.5.1.jar:5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        at org.elasticsearch.bootstrap.Elasticsearch.execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Elasticsearch.java:114"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("elasticsearch-5.5.1.jar:5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        at org.elasticsearch.cli.EnvironmentAwareCommand.execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("EnvironmentAwareCommand.java:67"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("elasticsearch-5.5.1.jar:5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        at org.elasticsearch.cli.Command.mainWithoutErrorHandling"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Command.java:122"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("elasticsearch-5.5.1.jar:5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        at org.elasticsearch.cli.Command.main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Command.java:88"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("elasticsearch-5.5.1.jar:5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        at org.elasticsearch.bootstrap.Elasticsearch.main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Elasticsearch.java:91"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("elasticsearch-5.5.1.jar:5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        at org.elasticsearch.bootstrap.Elasticsearch.main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Elasticsearch.java:84"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("elasticsearch-5.5.1.jar:5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nCaused by: java.lang.RuntimeException: can not run elasticsearch as root\n        at org.elasticsearch.bootstrap.Bootstrap.initializeNatives"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Bootstrap.java:106"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("elasticsearch-5.5.1.jar:5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        at org.elasticsearch.bootstrap.Bootstrap.setup"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Bootstrap.java:194"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("elasticsearch-5.5.1.jar:5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        at org.elasticsearch.bootstrap.Bootstrap.init"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Bootstrap.java:351"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("elasticsearch-5.5.1.jar:5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        at org.elasticsearch.bootstrap.Elasticsearch.init"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Elasticsearch.java:123"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("elasticsearch-5.5.1.jar:5.5.1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(". "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("more")]),t._v("\n\n* 解决方案 新建ES用户\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  添加一个用户组")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# groupadd esgroup")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 添加一个用户，-g是在用户组下 -p是密码")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost local"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# useradd esuser -g esgroup -p Abcde12345_")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 把ES的安装包拷贝到esuser的home目录下，然后找个地方解压，如果是在root目录下，后面会遇到比较多的问题")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 进入es的安装目录")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost local"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd /usr/local/elasticsearch")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 给用户esuser授权 chown [-cfhvR] [--help] [--version] user[:group] file...")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost local"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# chown -R esuser:esgroup elasticsearch-5.5.1/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 切换到esuser用户")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost elasticsearch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# su esuser")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  再次启动")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("XXX@localhost elasticsearch"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ ./bin/elasticsearch\n")])])]),s("h3",{attrs:{id:"找不到java环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#找不到java环境"}},[t._v("#")]),t._v(" 找不到JAVA环境")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[esuser@VM_0_12_centos elasticsearch-5.5.1]$ ./bin/elasticsearch\nError: Could not find or load main class org.elasticsearch.tools.JavaVersionChecker\nElasticsearch requires at least Java 8 but your Java version from /apps/jdk1.8.0_25/bin/java does not meet this requirement\n\n* 把elasticsearch目录换到不属于root目录的其他目录就行了\n")])])]),s("h3",{attrs:{id:"vm-max-map-count不足"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vm-max-map-count不足"}},[t._v("#")]),t._v(" vm.max_map_count不足")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("ERROR: "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" bootstrap checks failed\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(": max virtual memory areas vm.max_map_count "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("65530")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" is too low, increase to at least "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("262144")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2021")]),t._v("-01-27T19:24:38,603"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("INFO "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("o.e.n.Node               "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Q-gAi65"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" stopping "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n\n* 解决方案\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" sysctl -w vm.max_map_count"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("262144")]),t._v("\n")])])]),s("h3",{attrs:{id:"使用dbeaver连接es时报-current-license-is-non-compliant-for-jdbc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用dbeaver连接es时报-current-license-is-non-compliant-for-jdbc"}},[t._v("#")]),t._v(" 使用DBeaver连接ES时报 current license is non-compliant for [jdbc]")]),t._v(" "),s("p",[t._v("默认安装的ES的类型type=basic，是不支持JDBC客户端连接的，白金版的才支持，查看")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('[root@VM_0_12_centos software]# curl -XGET http://localhost:9200/_license\n{\n  "license" : {\n    "status" : "active",\n    "uid" : "8d3fd3a6-0861-4a95-9a7b-0ce499474b3b",\n    "type" : "basic",\n    "issue_date" : "2021-01-28T08:53:11.889Z",\n    "issue_date_in_millis" : 1611823991889,\n    "max_nodes" : 1000,\n    "issued_to" : "elasticsearch",\n    "issuer" : "elasticsearch",\n    "start_date_in_millis" : -1\n  }\n}\n')])])]),s("p",[t._v("再使用上述命令查看type=trail，刷新客户端就可以连接了")]),t._v(" "),s("h3",{attrs:{id:"error-content-type-header-application-x-www-form-urlencoded-is-not-supported"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#error-content-type-header-application-x-www-form-urlencoded-is-not-supported"}},[t._v("#")]),t._v(' "error" : "Content-Type header [application/x-www-form-urlencoded] is not supported"')]),t._v(" "),s("p",[t._v("这个问题，是在报文Content-type的参数：application/x-www-form-urlencoded不支持Json发送。需要改成application/Json\n所以需要添加参数 ; -H ‘Content-Type: application/json’")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("esuser@VM_0_12_centos root"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -X PUT "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:9200/accounts'")]),t._v(" -H "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content-Type:application/json'")]),t._v(" -d "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{"mappings":{"person":{"properties":{"user":{"type":"text","analyzer":"ik_max_word","search_analyzer":"ik_max_word"},"title":{"type":"text","analyzer":"ik_max_word","search_analyzer":"ik_max_word"},"desc":{"type":"text","analyzer":"ik_max_word","search_analyzer":"ik_max_word"}}}}}\'')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"acknowledged"')]),t._v(":true,"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"shards_acknowledged"')]),t._v(":true,"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"index"')]),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"accounts"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);